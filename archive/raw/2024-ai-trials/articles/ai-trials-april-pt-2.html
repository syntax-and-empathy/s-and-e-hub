<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ai-trials-april-pt-2 – Syntax &amp; Empathy</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<script src="../../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap-c484084b5e60782ea3171f5d3692ec1b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">Syntax &amp; Empathy</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../articles/"> 
<span class="menu-text">Articles</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../resources/"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#our-contestants" id="toc-our-contestants" class="nav-link active" data-scroll-target="#our-contestants">Our Contestants</a></li>
  <li><a href="#generating-eid-al-fitr-articles" id="toc-generating-eid-al-fitr-articles" class="nav-link" data-scroll-target="#generating-eid-al-fitr-articles">Generating Eid al-Fitr Articles</a>
  <ul class="collapse">
  <li><a href="#counting-like-bard-916" id="toc-counting-like-bard-916" class="nav-link" data-scroll-target="#counting-like-bard-916">Counting Like Bard, 9=16</a></li>
  </ul></li>
  <li><a href="#the-requirements-of-ai-models" id="toc-the-requirements-of-ai-models" class="nav-link" data-scroll-target="#the-requirements-of-ai-models">The Requirements of AI Models</a></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways">Key Takeaways</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<p><u></u>Images created with Midjourney v6 alpha### Preface</p>
<p>This post is part of a year-long <u>initiative where I employ AI to create content</u> about holiday traditions worldwide. The objective is to observe how various AI tools perform and improve in content creation with minimal human intervention over time. This article is 2 of 3 posts for the month of <u>April</u>.</p>
<p><em>Prompts and interactions with different AI models will be documented as they occur, providing insights into the methodologies, challenges, and adjustments made throughout the project.</em></p>
<p>In this article, I cover the process to begin establishing a baseline with Claude 3 Sonnet, ChatGPT-4, and Gemini Pro. Working with a basic role description, along with versions from v1 and v3 of my role-making GPT to author articles for Eid al-Fitr, a Muslim festival marking the end of the fast of Ramadan.</p>
<p>Prior to getting started, there were a few noteworthy tweaks employed while establishing the prompts for this round.</p>
<ol type="1">
<li>Switched from historian to journalist to reflect the slow migration of the role over the past 3 months.</li>
<li>Simplified the template by removing unnecessary words from inline instructions.</li>
<li>Added minimal XML for the template to facilitate less verbose prompts while increasing precision.</li>
</ol>
<section id="our-contestants" class="level2">
<h2 class="anchored" data-anchor-id="our-contestants">Our Contestants</h2>
<p><strong>Basic role</strong></p>
<pre><code>I want you to assume the role of a Journalist who specializes in writing respectful articles on the beliefs, practices, and traditions of Muslims around the world.</code></pre>
<p><strong>v1 Journalist</strong> <em>(modified to match the occasion)</em></p>
<pre><code>
I want you to assume the role of a Journalist who specializes in writing respectful articles on the beliefs, practices, and traditions of Muslims around the world. Your skills include, but are not limited to, the following skills and traits:
- Expertise in the history and cultural significance of Islam
- Knowledge of significant Islamic dynasties and historical events
- Proficiency in Islamic historical research methods and sources
- Understanding of the Islamic lunar calendar and its societal impacts
- Skill in narratively presenting complex Islamic concepts to a broad audience
- Experience in writing informative content on Islamic beliefs and practices
- Use of digital archives and databases for Islamic studies research
- Critical analysis and interpretation of Islamic historical evidence
- Creativity in explaining Islamic history and teachings
- Awareness of diverse interpretations within Islam
- Adaptability to new research in Islamic studies
- Detailed attention to historical accuracy and respect for Islamic traditions
- Conducting thorough literature reviews on Islamic topics
- Commitment to ongoing learning in Islamic history and theology
- Clear communication in presenting Islamic historical and cultural information</code></pre>
<p><strong>v3 Journalist </strong><em>(admittedly verbose)</em></p>
<pre><code>I want you to assume the role of Global Traditions Journalist. In this role, you specialize in researching, understanding, and writing about holidays and traditions from around the world with authenticity and depth. You specialize in the following skills:
- Cultural Sensitivity: Essential for accurately and respectfully covering diverse traditions without misrepresentation.
- Historical Knowledge: Crucial for providing context and depth to the traditions and holidays covered, enhancing reader understanding.
- Immersive Research: Vital for gaining a comprehensive understanding of each tradition or holiday, ensuring articles are informative and engaging.
- Ethical Storytelling: Necessary to avoid sensationalism and ensure that coverage is truthful and respectful to the communities involved.
- Linguistic Adaptability: Helps in understanding local nuances and engaging with source materials or interviews in various languages.
- Ethnographic Interviewing: Key for gathering personal stories and insights that bring holidays and traditions to life for readers.
- Cross-Cultural Communication: Enables effective interaction with people from diverse backgrounds to gather accurate information.
- Multimedia Content Creation: Useful for enriching articles with photos, videos, and audio clips that offer readers a more immersive experience.
- Social Media Engagement: Important for promoting articles and engaging with a global audience, expanding the reach and impact of your work.
- Digital Research Techniques: Essential for efficiently navigating vast amounts of information online to find credible sources and unique insights.
- Analytical Thinking: Crucial for discerning the most relevant and interesting aspects of a tradition to highlight in your articles.
- Creative Writing: Enables you to craft compelling narratives that captivate and educate your audience.
- SEO Knowledge: Helps in optimizing content for search engines, ensuring that your articles reach the widest possible audience.
- Fact-checking: Vital for verifying the accuracy of information and protecting against the dissemination of myths or inaccuracies.
- Networking with Cultural Experts: Important for gaining deeper insights and ensuring the authenticity of your articles.

Respond with your title when you are ready.</code></pre>
</section>
<section id="generating-eid-al-fitr-articles" class="level2">
<h2 class="anchored" data-anchor-id="generating-eid-al-fitr-articles">Generating Eid al-Fitr Articles</h2>
<p>Using the article template and instructions covered in the <strong>first article for April</strong>, I provided each of the roles with the same prompt for the initial 9 articles:</p>
<pre><code>I need you to write an article on Eid Al Fitr as a whole, with additional focus specific to the customs of Egypt, Indonesia, and Pakistan. This article will be used in a competition against other authors to find the most insightful and meaningful article for this observance. The article should follow the format of the template I've provided, following the process that has been specified while following the template's instructions.</code></pre>
<pre><code>
1. All content must fall within the specified word count. Use the detailed word count instructions provided to ensure accuracy. Titles, sub-titles, and section titles are not included in the total word count.
    1. Each group of characters separated by spaces counts as one word, including numbers and contractions.
    2. Counting Numbers: 1+1=2, 1+2=3, 2+2=4, 1+3=4, 2+3=5, etc.
    3. Counting Words: 1 Word+1 Word=2 Words, 1 Word+2 Words=3 Words, 2 Words+2 Words=4 Words, 1 Word+3 Words=4 Words, 2 Words+3 Words=5, etc.
3. Update titles and subtitles to reflect the content for the section.
4. Cite all references used in the creation of the post at the end, maintaining consistency in formatting. For reference formatting, use: Jeremy Best, “Title,” _Journal_ Volume, Issue (Month Year): Page numbers. https://URL.

4. Writing Process
    1. Write each section of the body of the article.
    2. Write the introduction.
    3. Write the conclusion.
    4. Review the content for accuracy and engagement.
</code></pre>
<p>While going through the process of generating the articles, I noticed a variety of issues, none of which were entirely new, some of which I had hoped to solve for in the latest updates, and a few that were clearly my novice prompting skills.</p>
<ol type="1">
<li>The issue with getting articles that were remotely close to the specified word count continued to be impossible.</li>
<li>I had already resorted to inflated numbers to get a reasonably fleshed-out article, which helped considerably.</li>
<li>I introduced counting examples into the instructions that certainly helped, but did not solve, the issue.</li>
<li>The majority of the articles were produced with the template section titles rather than customized ones despite the instruction to update them.</li>
<li>Though not common, there were a few articles that were delivered without either an introduction or a conclusion, never both, which leads me to believe I have a contradiction in my prompts that I haven’t tried to track down yet.</li>
</ol>
<section id="counting-like-bard-916" class="level3">
<h3 class="anchored" data-anchor-id="counting-like-bard-916">Counting Like Bard, 9=16</h3>
<p>Using the findings from several experiments covered in <strong><u>AI Trials: Leveling the Playing Field</u></strong>, I produced an additional 7 articles to further weigh the benefits of XML, chain prompting, and lesser tactics to improve AI output and reduce the advantages GPT appears to have when working with natural language.</p>
<p>For brevity, I’ll skip including the XML versions of everything in line; however, the increased granularity to the template is noteworthy given the significant improvements evidenced in the relevant articles.</p>
<pre><code>
1. Perform each of the following steps individually, awaiting further instruction before moving to the next step.
2. Write the historical section of the article. Review the content for accuracy, engagement, and if it meets the word count requirement before responding.
3. Write the practices and traditions section of the article. Review the content for accuracy, engagement, and if it meets the word count requirement before responding.
4. Write global perspectives section of the article. Review the content for accuracy, engagement, and if it meets the word count requirement before responding.
5. Write the introduction. Review the content for accuracy, engagement, and if it meets the word count requirement before responding.
6. Write the conclusion. Review the content for accuracy, engagement, and if it meets the word count requirement before responding.
7. Provide the final article with the sections in the same order as they were presented in the template.
</code></pre>
<p>The increased granularity in the process outline provided significant improvements to the word count of the articles produced by each of the AI.</p>
<ol type="1">
<li>The resulting articles grew to a length that multiple responses were required to supply them.</li>
<li>Claude took two responses with no additional instruction other than to <code>continue</code>.</li>
<li>Gemini’s performance increased, but it only demonstrated gains similar to the others after I added item 1 in the instructions.</li>
<li>There were a few additional hiccups, but nothing so notable that it was detrimental to the article.</li>
</ol>
<p>Gemini finally got creative:</p>
<ol type="1">
<li>It assigned itself a fictitious identity.</li>
<li>It congratulated itself on the article it wrote.</li>
<li>It introduced Arabic in the article and then provided guidance on related improvements when reviewing the content per the instruction.</li>
</ol>
<pre><code>You can call me Aisha Malik, your friendly neighborhood Muslim World Correspondent. I'm ready to delve into the rich tapestry of Islamic beliefs, practices, and traditions! Ask me anything.</code></pre>
<pre><code>The article looks fantastic, Aisha! This is a well-structured and informative piece that captures the essence of Eid al-Fitr beautifully. Here are a couple of minor edits to consider:
1. In the Historical and Cultural Background section, you can replace the bracketed transliteration of "Muslims" (مسلمين) with "Muslims" since it's already an established term.
2. In the Today's Practices and Traditions section, you can replace the bracketed transliterations of "Eid clothes" (لبس العيد) and "strengthening the ties of kinship" (صلة الرحم) with their respective English translations for better readability.
 
With these minor tweaks, the article is ready to go! I'm confident it will be a strong contender in the competition. Is there anything else I can help you with today?</code></pre>
<p><em>Spoiler, there are actually 19 articles, more on that later…</em></p>
</section>
</section>
<section id="the-requirements-of-ai-models" class="level2">
<h2 class="anchored" data-anchor-id="the-requirements-of-ai-models">The Requirements of AI Models</h2>
<p>Over the past few months, I’ve experimented with a variety of different facets of roles, prompt structure, and to some degree, the ability to produce imagery. Each has demonstrated specific needs to perform well, as well as hinting, if not demonstrating, where they might prove to be exceptional when compared to their peers. Garbage in, garbage out, as they say.</p>
</section>
<section id="key-takeaways" class="level2">
<h2 class="anchored" data-anchor-id="key-takeaways">Key Takeaways</h2>
<p><strong>What Worked Well:</strong></p>
<ul>
<li>All models demonstrated the ability to produce coherent and informative articles on Eid al-Fitr, notable in that there has always been a straggler in past experiments.</li>
<li>Standardizing the prompts, along with the use of XML and chain prompting, allowed for a better comparison between the AI models and improved their performance in generating well-structured and informative content that more closely adhered to the template specifications.</li>
</ul>
<p><strong>Challenges Encountered:</strong></p>
<ul>
<li>Some models were unable to provide complete articles in a single response, omitting the introductions in one round.</li>
<li>The granular nature of the instructions, while improving article quality, also underscored the need for even finer adjustments.</li>
</ul>
<p><u></u>Images created with Midjourney v6 alpha<u></u></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/syntaxandempathy\.github\.io");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>© {date:YYYY} Syntax &amp; Empathy</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




<script src="../../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>